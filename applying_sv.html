<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="styles/applying_sv.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <title>Admin Dashboard</title>
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="logo-container">
            <img src="resources/images/logo.png" alt="PaRepair Logo">
            <h2>PaRepair Admin</h2>
        </div>
        <button class="toggle-btn" id="toggle-btn">
            <i class="fas fa-bars"></i>
        </button>
        <hr class="divider">
        <nav class="sidebar-menu">
          <ul>
              <li><a href="#dashboard"><i class="fas fa-tachometer-alt"></i><span> Dashboard</span></a></li>
              <li><a href="#appointments"><i class="fas fa-calendar-check"></i><span> Appointments</span></a></li>
              <li><a href="#users"><i class="fas fa-users"></i><span> Users</span></a></li>
              <li><a href="#settings"><i class="fas fa-cog"></i><span> Settings</span></a></li>
              <li><a href="#reports"><i class="fas fa-chart-line"></i><span> Reports</span></a></li>
              <li><a href="#apply-service"><i class="fas fa-clipboard-list"></i><span> Apply for Service</span></a></li>
              <li><a href="#manage-services"><i class="fas fa-cogs"></i><span> Manage Services</span></a></li>
              <li><a href="#service-status"><i class="fas fa-check-circle"></i><span> Service Status</span></a></li>
              <li><a id="logout-button"><i class="fas fa-sign-out-alt"></i><span> Logout</span></a></li>
          </ul>
      </nav>      
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
        <header class="dashboard-header">
          <div class="welcome-message">
            <h1>Welcome, Admin!</h1>
            <p>Hereâ€™s an overview of your dashboard</p>
          </div>
          <div class="header-right">    
            <input type="text" placeholder="Search..." class="search-bar">
            <div class="profile">
              <img src="resources/images/logo.png" alt="Admin Profile">
            </div>
          </div>
        </header>


        <!-- Table -->
        <section class="table-container">
          <h2>Applying for Service Provider</h2>
          <table class="appointments-table">
              <thead>
                  <tr>
                      <th>#</th>
                      <th>Client Name</th>
                      <th>Service Provider</th>
                      <th>Date</th>
                      <th>Time</th>
                      <th>Status</th>
                      <th>Action</th>
                  </tr>
              </thead>
              <tbody id="appointments-tbody">
              </tbody>
          </table>
      </section>
        
    </main>
  </div>

  

  <script src="resources/js/dashboard.js"></script>
  <script src="chart.js"></script>
  <script type="module">
  import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBHJ025X5bX0-nhwvbq5CTNxCtRyvGYJE4",
  authDomain: "parepair-63325.firebaseapp.com",
  projectId: "parepair-63325",
  storageBucket: "parepair-63325.appspot.com",
  messagingSenderId: "269243614085",
  appId: "1:269243614085:web:af243ba37f8f12f2d1faec"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

async function fetchUserData(userId) {
  const userDocRef = doc(db, "users", userId);
  onSnapshot(userDocRef, (userDoc) => {
    if (userDoc.exists()) {
      document.getElementById("user-data").innerHTML = `<p>User Data: ${JSON.stringify(userDoc.data())}</p>`;
    }
  });
}

async function writeUserData(userId, data) {
  const userDocRef = doc(db, "users", userId);
  await setDoc(userDocRef, data, { merge: true });
}


auth.onAuthStateChanged((user) => {
  if (user) {
    const userId = user.uid;
    fetchUserData(userId);
    writeUserData(userId, { lastLogin: new Date().toISOString() });
  } else {
    window.location.href = "index.html";
  }
});

document.getElementById("logout-button").addEventListener("click", async () => {
  await signOut(auth);
  sessionStorage.removeItem("isLoggedIn");
  window.location.href = "index.html";
});

  </script>
</body>
</html>
