<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="styles/appointment.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <title>Admin Dashboard</title>
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="logo-container">
            <img src="resources/images/logo.png" alt="PaRepair Logo">
            <h2>PaRepair Admin</h2>
        </div>
        <button class="toggle-btn" id="toggle-btn">
            <i class="fas fa-bars"></i>
        </button>
        <hr class="divider">
        <nav class="sidebar-menu">
          <ul>
              <li><a href="dashboard.html"><i class="fas fa-tachometer-alt"></i><span> Dashboard</span></a></li>
              <li><a href="appointments.html"><i class="fas fa-calendar-check"></i><span> Appointments</span></a></li>
              <li><a href="users.html"><i class="fas fa-users"></i><span> Users</span></a></li>
              <li><a href="#settings"><i class="fas fa-cog"></i><span> Settings</span></a></li>
              <li><a href="#reports"><i class="fas fa-chart-line"></i><span> Reports</span></a></li>
              <li><a href="applying_sv.html"><i class="fas fa-clipboard-list"></i><span> Apply for Service</span></a></li>
              <li><a href="#manage-services"><i class="fas fa-cogs"></i><span> Manage Services</span></a></li>
              <li><a href="#service-status"><i class="fas fa-check-circle"></i><span> Service Status</span></a></li>
              <li><a id="logout-button"><i class="fas fa-sign-out-alt"></i><span> Logout</span></a></li>
          </ul>
      </nav>      
    </aside>


    
<!-- Modal Structure -->
<div id="userModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>User Details</h2>
    
    <div class="info-box">
      <label>Full Name:</label>
      <span id="modalFullName">N/A</span>
    </div>

    <div class="info-box">
      <label>Primary Skill:</label>
      <span id="modalPrimarySkill">N/A</span>
    </div>

    <div class="info-box">
      <label>Years of Experience:</label>
      <span id="modalExperience">N/A</span>
    </div>

    <div class="info-box">
      <label>License Number:</label>
      <span id="modalLicenseNumber">N/A</span>
    </div>

    <div class="info-box">
      <label>Certification:</label>
      <span id="modalCertification">N/A</span>
    </div>

    <div class="info-box">
      <label>Max Travel Distance:</label>
      <span id="modalTravelDistance">N/A</span>
    </div>

  </div>
</div>

    
    <!-- Main Content -->
    <main class="main-content">
        <header class="dashboard-header">
          <div class="welcome-message">
            <h1>Welcome, Admin!</h1>
            <p>Hereâ€™s an overview of your dashboard</p>
          </div>
          <div class="header-right">    
            <input type="text" placeholder="Search..." class="search-bar">
            <div class="profile">
              <img src="resources/images/logo.png" alt="Admin Profile">
            </div>
          </div>
        </header>

        <!-- Table -->
        <section class="table-container">
          <h2>Appointments</h2>
          <table class="appointments-table">
              <thead>
                  <tr>
                      <th>#</th>
                      <th>Client Name</th>
                      <th>Service Provider Name</th>
                      <th>Booking Status</th>
                      <th>Payment Method</th>
                      <th>Job Size</th>
                      <th>Job</th>
                  </tr>
              </thead>
              <tbody id="appointments-tbody">
              </tbody>
          </table>
          <br>
          <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-center">
              <!-- Pagination items will be dynamically generated by JavaScript -->
            </ul>
          </nav>
      </section>
        
    </main>
  </div>

  

  <script src="resources/js/dashboard.js"></script>
  <script src="chart.js"></script>
  <script type="module">
    import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, query, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
  
    const firebaseConfig = {
      apiKey: "AIzaSyBHJ025X5bX0-nhwvbq5CTNxCtRyvGYJE4",
      authDomain: "parepair-63325.firebaseapp.com",
      projectId: "parepair-63325",
      storageBucket: "parepair-63325.appspot.com",
      messagingSenderId: "269243614085",
      appId: "1:269243614085:web:af243ba37f8f12f2d1faec"
    };
  
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
  
    let appointments = [];
    let currentPage = 1;
    const itemsPerPage = 5;
  
    function renderTable(page = 1) {
      const tbody = document.getElementById("appointments-tbody");
      tbody.innerHTML = "";
  
      const start = (page - 1) * itemsPerPage;
      const end = page * itemsPerPage;
      const paginatedItems = appointments.slice(start, end);
  
      paginatedItems.forEach((data, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${start + index + 1}</td>
          <td>${data.clientFullName || "N/A"}</td>
          <td>${data.serviceProviderFullName || "N/A"}</td>
          <td>${data.bookingStatus || "N/A"}</td>
          <td>${data.paymentMethod || "N/A"}</td>
          <td>${data.jobSize || "N/A"}</td>
          <td>${data.serviceProviderJob || "N/A"}</td>
        `;
        tbody.appendChild(row);
      });
  
      renderPagination();
    }
  
    function renderPagination() {
      const pagination = document.querySelector(".pagination");
      pagination.innerHTML = "";
  
      const totalPages = Math.ceil(appointments.length / itemsPerPage);
  
      // Previous Button
      const prevPage = document.createElement("li");
      prevPage.className = `page-item ${currentPage === 1 ? "disabled" : ""}`;
      prevPage.innerHTML = `<a class="page-link" href="#" tabindex="-1">Previous</a>`;
      prevPage.addEventListener("click", () => {
        if (currentPage > 1) {
          currentPage--;
          renderTable(currentPage);
        }
      });
      pagination.appendChild(prevPage);
  
      // Page Numbers
      for (let i = 1; i <= totalPages; i++) {
        const pageItem = document.createElement("li");
        pageItem.className = `page-item ${currentPage === i ? "active" : ""}`;
        pageItem.innerHTML = `<a class="page-link" href="#">${i}</a>`;
        pageItem.addEventListener("click", () => {
          currentPage = i;
          renderTable(currentPage);
        });
        pagination.appendChild(pageItem);
      }
  
      // Next Button
      const nextPage = document.createElement("li");
      nextPage.className = `page-item ${currentPage === totalPages ? "disabled" : ""}`;
      nextPage.innerHTML = `<a class="page-link" href="#">Next</a>`;
      nextPage.addEventListener("click", () => {
        if (currentPage < totalPages) {
          currentPage++;
          renderTable(currentPage);
        }
      });
      pagination.appendChild(nextPage);
    }
  
    function listenForApplyingUsers() {
      const usersRef = collection(db, "appointments");
      const applyingQuery = query(usersRef);
  
      onSnapshot(applyingQuery, (querySnapshot) => {
        appointments = [];
        querySnapshot.forEach((docSnapshot) => {
          appointments.push(docSnapshot.data());
        });
  
        renderTable(currentPage); // Render the first page initially
      });
    }
  
    auth.onAuthStateChanged((user) => {
      if (user) {
        listenForApplyingUsers();
      } else {
        window.location.href = "index.html";
      }
    });
  
    document.getElementById("logout-button").addEventListener("click", async () => {
      await signOut(auth);
      sessionStorage.removeItem("isLoggedIn");
      window.location.href = "index.html";
    });
  </script>
  
  
</body>
</html>
